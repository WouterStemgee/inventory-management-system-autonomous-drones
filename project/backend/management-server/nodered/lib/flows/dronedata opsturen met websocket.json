[{"id":"b20dddd4.14cc","type":"mqtt in","z":"255a5fc3.778f","name":"","topic":"drone/battery","qos":"1","datatype":"json","broker":"589a5dc9.f0f7f4","x":390,"y":300,"wires":[["c2976161.faf2b"]]},{"id":"13aa45df.4b13ba","type":"mqtt in","z":"255a5fc3.778f","name":"","topic":"drone/position","qos":"2","datatype":"json","broker":"589a5dc9.f0f7f4","x":410,"y":120,"wires":[["c2976161.faf2b"]]},{"id":"3b690536.6232ca","type":"mqtt in","z":"255a5fc3.778f","name":"","topic":"drone/acceleration","qos":"1","datatype":"json","broker":"589a5dc9.f0f7f4","x":390,"y":180,"wires":[["c2976161.faf2b"]]},{"id":"db2847e7.fafe78","type":"mqtt in","z":"255a5fc3.778f","name":"","topic":"drone/speed","qos":"1","datatype":"json","broker":"589a5dc9.f0f7f4","x":410,"y":220,"wires":[["c2976161.faf2b"]]},{"id":"391ed5b3.86b00a","type":"mqtt in","z":"255a5fc3.778f","name":"","topic":"drone/orientation","qos":"1","datatype":"json","broker":"589a5dc9.f0f7f4","x":400,"y":260,"wires":[["c2976161.faf2b"]]},{"id":"182c5df5.1d5102","type":"function","z":"255a5fc3.778f","name":"convertPayload","func":"let subs = global.get('subscriptions') || {};\nmsg.subs = subs;\n\nlet properties = {};\n\nif(Object.keys(subs).length) {\n    for (let key in subs){\n        if(subs[key] === true)\n            properties[key] = global.get('drone/' + key);\n    }\n}\nproperties['radius'] = global.get('drone/radius');\n\nlet position = subs['position'] ? global.get('drone/position') : {\"x\":0, \"y\":0, \"z\":0};\nlet geoJSON = {\n            \"type\": \"FeatureCollection\",\n            \"features\": [{\n                \"type\": \"Feature\",\n                \"properties\": properties,\n                \"geometry\": {\n                    \"type\": \"Point\",\n                    \"coordinates\": [position.x, position.y, position.z]\n                }\n            }]\n        };\n        \nmsg.payload = geoJSON;\nreturn msg;","outputs":1,"noerr":0,"x":940,"y":180,"wires":[["81588da6.f6b2b","da7df5be.f5f8e8"]]},{"id":"4a48fcd7.aa7f14","type":"function","z":"255a5fc3.778f","name":"store","func":"global.set(msg.topic, msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":180,"wires":[["182c5df5.1d5102"]]},{"id":"81588da6.f6b2b","type":"websocket out","z":"255a5fc3.778f","name":"","server":"b63ed86.b28ef28","client":"","x":1170,"y":180,"wires":[]},{"id":"b2a512f3.b7674","type":"http in","z":"255a5fc3.778f","name":"","url":"/drone","method":"put","upload":false,"swaggerDoc":"","x":100,"y":420,"wires":[["846cbe83.24243"]]},{"id":"779d8689.486288","type":"function","z":"255a5fc3.778f","name":"drone/radius","func":"msg.topic = 'drone/radius';\n\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":460,"wires":[["4a48fcd7.aa7f14","b3cbea80.c18ab8","6d1e85a4.460b6c"]]},{"id":"846cbe83.24243","type":"template","z":"255a5fc3.778f","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{payload}}","output":"json","x":280,"y":420,"wires":[["779d8689.486288","941d8dd3.23d5a"]]},{"id":"b3cbea80.c18ab8","type":"debug","z":"255a5fc3.778f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":640,"y":460,"wires":[]},{"id":"c2976161.faf2b","type":"json","z":"255a5fc3.778f","name":"","property":"payload","action":"obj","pretty":false,"x":590,"y":180,"wires":[["4a48fcd7.aa7f14"]]},{"id":"da7df5be.f5f8e8","type":"debug","z":"255a5fc3.778f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1170,"y":140,"wires":[]},{"id":"941d8dd3.23d5a","type":"debug","z":"255a5fc3.778f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":450,"y":400,"wires":[]},{"id":"3e72421b.6a5fbe","type":"mqtt in","z":"255a5fc3.778f","name":"","topic":"drone/multiple","qos":"1","datatype":"auto","broker":"589a5dc9.f0f7f4","x":410,"y":80,"wires":[["b6743e38.80d55"]]},{"id":"b6743e38.80d55","type":"json","z":"255a5fc3.778f","name":"","property":"payload","action":"obj","pretty":false,"x":570,"y":80,"wires":[["ab37106.5fde9f"]]},{"id":"ab37106.5fde9f","type":"function","z":"255a5fc3.778f","name":"storeAll","func":"for(const key of Object.keys(msg.payload)){\n    global.set(key, msg.payload[key]);\n}\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":80,"wires":[["182c5df5.1d5102"]]},{"id":"6d1e85a4.460b6c","type":"http response","z":"255a5fc3.778f","name":"","statusCode":"200","headers":{},"x":640,"y":500,"wires":[]},{"id":"589a5dc9.f0f7f4","type":"mqtt-broker","z":"","name":"mosquitto","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"b63ed86.b28ef28","type":"websocket-listener","z":"","path":"/ws/data","wholemsg":"false"}]