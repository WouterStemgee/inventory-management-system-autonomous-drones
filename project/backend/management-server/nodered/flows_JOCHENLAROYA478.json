[{"id":"2ca3cc6f.3b71c4","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"6a2c9f2f.7b12e","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"8e18b7f7.3c18b8","type":"mqtt-broker","z":"","name":"mosquitto","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"433fd7c3.c6ba68","type":"websocket-listener","z":"","path":"/ws/data","wholemsg":"false"},{"id":"c1fb898d.5d01a8","type":"mqtt-broker","z":"","name":"local mosquitto","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","closeTopic":"","closeQos":"0","closeRetain":"false","closePayload":"","willTopic":"","willQos":"0","willRetain":"false","willPayload":""},{"id":"f49d3473.7fc848","type":"mqtt in","z":"2ca3cc6f.3b71c4","name":"","topic":"drone/battery","qos":"1","datatype":"auto","broker":"8e18b7f7.3c18b8","x":130,"y":740,"wires":[["56b20655.cc96c8"]]},{"id":"ae68c633.e69408","type":"mqtt in","z":"2ca3cc6f.3b71c4","name":"","topic":"drone/position","qos":"2","datatype":"json","broker":"8e18b7f7.3c18b8","x":130,"y":680,"wires":[["56b20655.cc96c8","9c4419ce.0648c8"]]},{"id":"d6968f18.f0098","type":"mqtt in","z":"2ca3cc6f.3b71c4","name":"","topic":"drone/acceleration","qos":"1","datatype":"auto","broker":"8e18b7f7.3c18b8","x":150,"y":500,"wires":[["56b20655.cc96c8"]]},{"id":"335d9298.14724e","type":"mqtt in","z":"2ca3cc6f.3b71c4","name":"","topic":"drone/speed","qos":"1","datatype":"auto","broker":"8e18b7f7.3c18b8","x":130,"y":560,"wires":[["56b20655.cc96c8"]]},{"id":"5c147374.6223ac","type":"mqtt in","z":"2ca3cc6f.3b71c4","name":"","topic":"drone/orientation","qos":"1","datatype":"auto","broker":"8e18b7f7.3c18b8","x":140,"y":620,"wires":[["56b20655.cc96c8"]]},{"id":"60eb761f.e45518","type":"inject","z":"2ca3cc6f.3b71c4","name":"","topic":"","payload":"50","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":360,"wires":[["9fafcb47.01f0c8"]]},{"id":"9fafcb47.01f0c8","type":"mqtt out","z":"2ca3cc6f.3b71c4","name":"","topic":"drone/speed","qos":"","retain":"","broker":"8e18b7f7.3c18b8","x":350,"y":360,"wires":[]},{"id":"aa09fcaa.f072e","type":"function","z":"2ca3cc6f.3b71c4","name":"convertPayload","func":"let subs = global.get('subscriptions') || {};\nmsg.subs = subs;\n\nlet properties = {};\n\nif(Object.keys(subs).length) {\n    for (let key in subs){\n        if(subs[key] === true)\n            properties[key] = flow.get('drone/' + key);\n    }\n}\n\nlet position = flow.get('drone/position')\n\nlet geoJSON = {\n            \"type\": \"FeatureCollection\",\n            \"features\": [{\n                \"type\": \"Feature\",\n                \"properties\": properties,\n                \"geometry\": {\n                    \"type\": \"Point\",\n                    \"coordinates\": [position.x, position.y, position.z]\n                }\n            }]\n        };\n        \nmsg.payload = geoJSON;\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":540,"wires":[["6af528e9.7b7ec8","4fbe8964.ead408"]]},{"id":"ddb1f9d0.51f788","type":"function","z":"2ca3cc6f.3b71c4","name":"store","func":"flow.set(msg.topic, msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":560,"wires":[["aa09fcaa.f072e"]]},{"id":"c33f8f69.4c246","type":"inject","z":"2ca3cc6f.3b71c4","name":"","topic":"battery","payload":"98","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":420,"wires":[["4baa1eaa.fd24a"]]},{"id":"4baa1eaa.fd24a","type":"mqtt out","z":"2ca3cc6f.3b71c4","name":"","topic":"drone/battery","qos":"","retain":"","broker":"8e18b7f7.3c18b8","x":340,"y":440,"wires":[]},{"id":"89472604.1ca008","type":"http in","z":"2ca3cc6f.3b71c4","name":"","url":"/data","method":"put","upload":false,"swaggerDoc":"","x":110,"y":1000,"wires":[["80605685.99be98"]]},{"id":"80605685.99be98","type":"function","z":"2ca3cc6f.3b71c4","name":"specifySubs","func":"let sub = global.get(\"subscriptions\") || {};\nfor(let key in msg.payload){\n    console.log(key);\n    if(msg.payload[key] == true)\n        sub[key] = true;\n    else sub[key] = false;\n    \n}\nglobal.set(\"subscriptions\", sub);\n\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":1000,"wires":[["c6748192.7325d"]]},{"id":"a832cf42.83441","type":"http response","z":"2ca3cc6f.3b71c4","name":"","statusCode":"200","headers":{},"x":840,"y":1080,"wires":[]},{"id":"b6b4d13e.16052","type":"function","z":"2ca3cc6f.3b71c4","name":"setAllSubs","func":"let sub = global.get(\"subscriptions\") || {};\nsub.acceleration = true;\nsub.speed = true;\nsub.orientation = true;\nsub.position = true;\nsub.battery = true;\nglobal.set(\"subscriptions\", sub);\n\nreturn msg;\n","outputs":1,"noerr":0,"x":290,"y":1120,"wires":[["c6748192.7325d"]]},{"id":"6af528e9.7b7ec8","type":"websocket out","z":"2ca3cc6f.3b71c4","name":"","server":"433fd7c3.c6ba68","client":"","x":880,"y":600,"wires":[]},{"id":"cee6ec25.8010a","type":"http in","z":"2ca3cc6f.3b71c4","name":"","url":"/data/all","method":"put","upload":false,"swaggerDoc":"","x":120,"y":1120,"wires":[["b6b4d13e.16052"]]},{"id":"ff39b4b6.550ac8","type":"http in","z":"2ca3cc6f.3b71c4","name":"","url":"/data/none","method":"put","upload":false,"swaggerDoc":"","x":130,"y":1200,"wires":[["f051ff83.2d2d8"]]},{"id":"f051ff83.2d2d8","type":"function","z":"2ca3cc6f.3b71c4","name":"clearSubs","func":"global.set(\"subscriptions\", {});\n\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":1200,"wires":[["c6748192.7325d"]]},{"id":"c6748192.7325d","type":"function","z":"2ca3cc6f.3b71c4","name":"generatePayload","func":"let sub = global.get(\"subscriptions\") || {};\nmsg.payload = \"\";\nfor(let key of Object.keys(sub)){\n    msg.payload += `${key}: ${sub[key]};\\n`;\n}\n//msg.payload = flow.get(\"drone/\" + msg.req.query);\nmsg.subs = global.subscriptions;\n\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":1080,"wires":[["3d4dee20.99bad2","a832cf42.83441"]]},{"id":"80fd4b6e.2f5f68","type":"inject","z":"2ca3cc6f.3b71c4","name":"DrukOpDezeKnopWouter!!","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":820,"wires":[["a3cb9d9e.41fe6"]]},{"id":"edc40556.ae1588","type":"inject","z":"2ca3cc6f.3b71c4","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":860,"wires":[["9f5fc90.ea90d38"]]},{"id":"a3cb9d9e.41fe6","type":"function","z":"2ca3cc6f.3b71c4","name":"setAllSubs","func":"let sub = global.get(\"subscriptions\") || {};\nsub.acceleration = true;\nsub.speed = true;\nsub.orientation = true;\nsub.position = true;\nsub.battery = true;\nsub.radius = true;\nglobal.set(\"subscriptions\", sub);\n","outputs":1,"noerr":0,"x":410,"y":820,"wires":[[]]},{"id":"9f5fc90.ea90d38","type":"function","z":"2ca3cc6f.3b71c4","name":"clearSubs","func":"global.set(\"subscriptions\", {});\n","outputs":1,"noerr":0,"x":400,"y":860,"wires":[[]]},{"id":"beeeae29.e2459","type":"inject","z":"2ca3cc6f.3b71c4","name":"","topic":"","payload":"25","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":280,"wires":[["fc5f4496.8c3bd8"]]},{"id":"fc5f4496.8c3bd8","type":"mqtt out","z":"2ca3cc6f.3b71c4","name":"","topic":"drone/orientation","qos":"","retain":"","broker":"8e18b7f7.3c18b8","x":330,"y":300,"wires":[]},{"id":"26dc42c9.b435de","type":"inject","z":"2ca3cc6f.3b71c4","name":"","topic":"","payload":"290","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":240,"wires":[["fc5f4496.8c3bd8"]]},{"id":"f6756259.f59d3","type":"inject","z":"2ca3cc6f.3b71c4","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":200,"wires":[["fc5f4496.8c3bd8"]]},{"id":"a72adaef.5ff948","type":"mqtt out","z":"2ca3cc6f.3b71c4","name":"","topic":"drone/position","qos":"","retain":"","broker":"8e18b7f7.3c18b8","x":370,"y":100,"wires":[]},{"id":"56b21c10.846654","type":"inject","z":"2ca3cc6f.3b71c4","name":"","topic":"","payload":"{ \"x\":10000, \"y\":0, \"z\":0 }","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":80,"y":80,"wires":[["a72adaef.5ff948"]]},{"id":"1c1beddb.ea8bd2","type":"inject","z":"2ca3cc6f.3b71c4","name":"","topic":"","payload":"{ \"x\":1000, \"y\":1000, \"z\":0 }","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":20,"wires":[["a72adaef.5ff948"]]},{"id":"dc2c172d.2f5b38","type":"inject","z":"2ca3cc6f.3b71c4","name":"","topic":"","payload":"1000","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":540,"y":120,"wires":[["24abaa7d.56ba26"]]},{"id":"a2e27ec6.08e5b","type":"inject","z":"2ca3cc6f.3b71c4","name":"","topic":"","payload":"2000","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":540,"y":180,"wires":[["24abaa7d.56ba26"]]},{"id":"3fbf14f5.ed5e4c","type":"http in","z":"2ca3cc6f.3b71c4","name":"","url":"/drone","method":"put","upload":false,"swaggerDoc":"","x":550,"y":60,"wires":[["5004f896.d09238"]]},{"id":"24abaa7d.56ba26","type":"function","z":"2ca3cc6f.3b71c4","name":"drone/radius","func":"msg.topic = 'drone/radius';\n\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":140,"wires":[["2c2764b1.e3f0cc","ddb1f9d0.51f788"]]},{"id":"5004f896.d09238","type":"template","z":"2ca3cc6f.3b71c4","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{payload}}","output":"json","x":730,"y":60,"wires":[["24abaa7d.56ba26"]]},{"id":"2c2764b1.e3f0cc","type":"debug","z":"2ca3cc6f.3b71c4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":930,"y":140,"wires":[]},{"id":"56b20655.cc96c8","type":"json","z":"2ca3cc6f.3b71c4","name":"","property":"payload","action":"obj","pretty":false,"x":330,"y":560,"wires":[["ddb1f9d0.51f788"]]},{"id":"9c4419ce.0648c8","type":"debug","z":"2ca3cc6f.3b71c4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":330,"y":680,"wires":[]},{"id":"aee26ac8.793da8","type":"debug","z":"2ca3cc6f.3b71c4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":930,"y":960,"wires":[]},{"id":"3d4dee20.99bad2","type":"change","z":"2ca3cc6f.3b71c4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"subscriptions","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":1000,"wires":[["aee26ac8.793da8"]]},{"id":"2b87a771.254d48","type":"http in","z":"2ca3cc6f.3b71c4","name":"","url":"/data","method":"get","upload":false,"swaggerDoc":"","x":110,"y":1040,"wires":[["c6748192.7325d"]]},{"id":"67ef58e2.e24668","type":"inject","z":"2ca3cc6f.3b71c4","name":"checkSubscriptions","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":900,"wires":[["5f1f9335.39e97c"]]},{"id":"a2bc2dde.072c9","type":"debug","z":"2ca3cc6f.3b71c4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":570,"y":900,"wires":[]},{"id":"5f1f9335.39e97c","type":"change","z":"2ca3cc6f.3b71c4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"subscriptions","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":900,"wires":[["a2bc2dde.072c9"]]},{"id":"4fbe8964.ead408","type":"debug","z":"2ca3cc6f.3b71c4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":880,"y":480,"wires":[]},{"id":"24a14d1f.c77b72","type":"http request","z":"6a2c9f2f.7b12e","name":"flightpath request","method":"POST","ret":"obj","paytoqs":false,"url":"http://localhost:3000/api/flightpath","tls":"","proxy":"","authType":"basic","x":290,"y":180,"wires":[["69f74fda.ea4cc"]]},{"id":"a07c628a.ad2d1","type":"http response","z":"6a2c9f2f.7b12e","name":"","statusCode":"200","headers":{},"x":620,"y":160,"wires":[]},{"id":"69f74fda.ea4cc","type":"switch","z":"6a2c9f2f.7b12e","name":"","property":"statuscode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"neq","v":"200","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":470,"y":180,"wires":[["a07c628a.ad2d1","65d7564a.c7ec18"],["70163492.800dfc"]]},{"id":"51197531.d35ffc","type":"http in","z":"6a2c9f2f.7b12e","name":"","url":"astar","method":"post","upload":false,"swaggerDoc":"","x":80,"y":180,"wires":[["24a14d1f.c77b72"]]},{"id":"70163492.800dfc","type":"http response","z":"6a2c9f2f.7b12e","name":"","statusCode":"500","headers":{},"x":620,"y":200,"wires":[]},{"id":"c91db7d0.5cb018","type":"inject","z":"6a2c9f2f.7b12e","name":"","topic":"","payload":"{\"waypoints\":[{\"x\":1000,\"y\":1000,\"scan\":false},{\"x\":1000,\"y\":10000,\"scan\":false},{\"x\":10000,\"y\":20000,\"scan\":false}]}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":470,"y":120,"wires":[["65d7564a.c7ec18"]]},{"id":"89dc2062.2623","type":"mqtt out","z":"6a2c9f2f.7b12e","name":"","topic":"drone/moveto","qos":"1","retain":"","broker":"c1fb898d.5d01a8","x":820,"y":120,"wires":[]},{"id":"65d7564a.c7ec18","type":"function","z":"6a2c9f2f.7b12e","name":"setvariabelen","func":"var waypoints = flow.get('waypoints') || {};\nvar moveteller = 0;\nvar destination = flow.get(\"destination\") || {};\n\nflow.set('waypoints',msg.payload);\nmsg.payload = flow.get('waypoints').waypoints[moveteller++]\nflow.set(\"destination\", msg.payload);\nflow.set('moveteller', moveteller);\n//reset want nieuwe coo om naartoe te gaan\nflow.set('stop',false);\nflow.set('scanning', false);\nflow.set('arrived', false);\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":120,"wires":[["89dc2062.2623"]]},{"id":"6a80b90d.acf1b8","type":"mqtt in","z":"6a2c9f2f.7b12e","name":"","topic":"drone/position","qos":"1","datatype":"auto","broker":"c1fb898d.5d01a8","x":80,"y":300,"wires":[["47eb2217.8cca5c"]]},{"id":"68d89acf.b60bd4","type":"function","z":"6a2c9f2f.7b12e","name":"radius - arrived?","func":"var stop = flow.get('stop') || false;\nvar moveteller = flow.get('moveteller');\nvar diffX = Math.abs(msg.payload.x - flow.get('destination').x);\nvar diffY = Math.abs(msg.payload.y - flow.get('destination').y);\nvar scan = flow.get('destination').scan;\n\n//enkel in de eerste if moet hij checken om te scannen\nif(stop === false && (diffX <= 0.1 && diffY <= 0.1)) {\n    //toegekomen dus eerst checken of hij moet scannen voor hij verder gaat\n    //wnr niet moet gescant worden, zoals anders\n    flow.set('arrived', true);\n    if(scan === false) {\n        if(moveteller < flow.get('waypoints').waypoints.length) {\n            msg.payload = flow.get('waypoints').waypoints[moveteller++];\n            flow.set('destination',msg.payload);\n        }\n        else {\n            //positie om terug te keren\n            moveteller -= 2;\n            stop = true;\n        }\n    }\n    //wnr wel moet gescant worden, wordt de volgende positie ingesteld na de scan\n    else {\n        flow.set('scanning',scan);\n    }\n}\nif(stop === true && (diffX <= 0.1 && diffY <= 0.1)) {\n    if(moveteller >= 0) {\n        msg.payload = flow.get('waypoints').waypoints[moveteller--];\n        flow.set('destination', msg.payload);\n    }\n    else {\n        // hier zal een commando komen om de drone te laten landen, anders gaat hij verder gaan in een loop want stop komt op false\n        stop = false;\n    }\n}\nflow.set('moveteller', moveteller);\nflow.set('stop', stop);\n//flow.set('diffX', diffX);\n//flow.set('diffY', diffY);\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":300,"wires":[["8c9199dc.c835d8","4cc15435.43189c","fe98b9e3.19a3e8","86c5a069.b163b","63ab7a38.8913e4","9c7d30f2.8ab2d","8a649eba.13e9d","8093cab1.b1d698"]]},{"id":"d0ef87a5.9e5b18","type":"mqtt out","z":"6a2c9f2f.7b12e","name":"","topic":"drone/moveto","qos":"","retain":"","broker":"c1fb898d.5d01a8","x":1280,"y":260,"wires":[]},{"id":"69d1b7a4.641c08","type":"json","z":"6a2c9f2f.7b12e","name":"","property":"payload","action":"","pretty":false,"x":430,"y":300,"wires":[["68d89acf.b60bd4"]]},{"id":"2550e939.b7ba86","type":"comment","z":"6a2c9f2f.7b12e","name":"Moveteller!!","info":"fout in de moveteller kan voor problemen zorgen\n(naar verkeerde coo vliegen -> opvangen met collision)","x":310,"y":60,"wires":[]},{"id":"47eb2217.8cca5c","type":"switch","z":"6a2c9f2f.7b12e","name":"scanning?","property":"scanning","propertyType":"flow","rules":[{"t":"false"}],"checkall":"true","repair":false,"outputs":1,"x":270,"y":300,"wires":[["69d1b7a4.641c08"]]},{"id":"8c9199dc.c835d8","type":"switch","z":"6a2c9f2f.7b12e","name":"","property":"scanning","propertyType":"flow","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":770,"y":300,"wires":[["68a15827.3b6b18"],["58868128.a0386"]]},{"id":"58868128.a0386","type":"mqtt out","z":"6a2c9f2f.7b12e","name":"","topic":"drone/scanner","qos":"1","retain":"","broker":"c1fb898d.5d01a8","x":940,"y":340,"wires":[]},{"id":"15536783.72d758","type":"comment","z":"6a2c9f2f.7b12e","name":"","info":"Eerst moet hij de juiste scangegevens doorsturen naar de drone\nEenmaal gescant, moeten de juiste gegevens in de databank worden opgeslaan (API endpoint)\n-moet nog gebeuren-","x":200,"y":360,"wires":[]},{"id":"43d5f41c.bc92ac","type":"debug","z":"6a2c9f2f.7b12e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":470,"y":420,"wires":[]},{"id":"4cc15435.43189c","type":"change","z":"6a2c9f2f.7b12e","name":"","rules":[{"t":"set","p":"destination","pt":"msg","to":"destination","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":460,"wires":[["950a96d6.243d18","f68625ff.ec8858"]]},{"id":"fe98b9e3.19a3e8","type":"change","z":"6a2c9f2f.7b12e","name":"","rules":[{"t":"set","p":"moveteller","pt":"msg","to":"moveteller","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":500,"wires":[["2eb6169b.46727a"]]},{"id":"86c5a069.b163b","type":"change","z":"6a2c9f2f.7b12e","name":"","rules":[{"t":"set","p":"stop","pt":"msg","to":"stop","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":540,"wires":[["4e8e932e.2f0a1c"]]},{"id":"63ab7a38.8913e4","type":"change","z":"6a2c9f2f.7b12e","name":"","rules":[{"t":"set","p":"waypoints","pt":"msg","to":"waypoints","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":580,"wires":[["98fd91f1.f14b"]]},{"id":"9c7d30f2.8ab2d","type":"change","z":"6a2c9f2f.7b12e","name":"","rules":[{"t":"set","p":"diffX","pt":"msg","to":"diffX","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":620,"wires":[["4e564330.fbff9c"]]},{"id":"950a96d6.243d18","type":"debug","z":"6a2c9f2f.7b12e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1050,"y":420,"wires":[]},{"id":"f68625ff.ec8858","type":"debug","z":"6a2c9f2f.7b12e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"destination","targetType":"msg","x":1060,"y":460,"wires":[]},{"id":"2eb6169b.46727a","type":"debug","z":"6a2c9f2f.7b12e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"moveteller","targetType":"msg","x":1060,"y":500,"wires":[]},{"id":"4e8e932e.2f0a1c","type":"debug","z":"6a2c9f2f.7b12e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"stop","targetType":"msg","x":1040,"y":540,"wires":[]},{"id":"98fd91f1.f14b","type":"debug","z":"6a2c9f2f.7b12e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"waypoints","targetType":"msg","x":1060,"y":580,"wires":[]},{"id":"4e564330.fbff9c","type":"debug","z":"6a2c9f2f.7b12e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"diffX","targetType":"msg","x":1040,"y":620,"wires":[]},{"id":"8a649eba.13e9d","type":"change","z":"6a2c9f2f.7b12e","name":"","rules":[{"t":"set","p":"diffY","pt":"msg","to":"diffY","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":660,"wires":[["526e0d2d.66f724"]]},{"id":"526e0d2d.66f724","type":"debug","z":"6a2c9f2f.7b12e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"diffY","targetType":"msg","x":1040,"y":660,"wires":[]},{"id":"8093cab1.b1d698","type":"change","z":"6a2c9f2f.7b12e","name":"","rules":[{"t":"set","p":"scan","pt":"msg","to":"scanning","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":800,"y":700,"wires":[["a2ec20e0.80302"]]},{"id":"a2ec20e0.80302","type":"debug","z":"6a2c9f2f.7b12e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"scan","targetType":"msg","x":1040,"y":700,"wires":[]},{"id":"cef8d5d9.3f6458","type":"mqtt in","z":"6a2c9f2f.7b12e","name":"","topic":"drone/scanned","qos":"1","datatype":"auto","broker":"c1fb898d.5d01a8","x":80,"y":420,"wires":[["f1a2f93b.7ad178"]]},{"id":"f1a2f93b.7ad178","type":"function","z":"6a2c9f2f.7b12e","name":"next destination","func":"var moveteller = flow.get('moveteller');\nvar stop = flow.get('stop');\n\nif(moveteller < flow.get('waypoints').waypoints.length) {\n    msg.payload = flow.get('waypoints').waypoints[moveteller++];\n    flow.set('destination',msg.payload);\n}\nelse {\n    //positie om terug te keren\n    moveteller -= 2;\n    stop = true;\n}\n\nflow.set('moveteller', moveteller);\nflow.set('stop', stop);\nflow.set('scanning', false);\n\nreturn msg;","outputs":1,"noerr":0,"x":280,"y":420,"wires":[["43d5f41c.bc92ac"]]},{"id":"25632435.4ccb5c","type":"change","z":"6a2c9f2f.7b12e","name":"","rules":[{"t":"set","p":"arrived","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1080,"y":260,"wires":[["d0ef87a5.9e5b18"]]},{"id":"68a15827.3b6b18","type":"switch","z":"6a2c9f2f.7b12e","name":"","property":"arrived","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":910,"y":260,"wires":[["25632435.4ccb5c"]]}]