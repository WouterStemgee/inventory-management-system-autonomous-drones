[{"id":"db7684b1.4266a8","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"cee8b808.bfd788","type":"websocket-listener","z":"","path":"/ws/data","wholemsg":"false"},{"id":"bc647504.9ec4b8","type":"mqtt-broker","z":"","name":"mosquitto","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"c85cff95.9f24","type":"function","z":"db7684b1.4266a8","name":"convertPayload","func":"let geoJSON = {\n            type: \"FeatureCollection\",\n            features: [{\n                \"type\": \"Feature\",\n                properties: {\n                    speed: flow.get(\"drone/peed\"),\n                    battery: flow.get(\"drone/battery\"),\n                    acceleration: flow.get(\"drone/acceleration\"),\n                    orientation: flow.get(\"drone/orientation\"),\n                    position: flow.get(\"drone/position\")\n                },\n                \"geometry\": {\n                    \"type\": \"Point\",\n                    \"coordinates\": [0, 0, 0]\n                }\n            }]\n        };\nmsg.payload = geoJSON;\nreturn msg;\n","outputs":1,"noerr":0,"x":560,"y":580,"wires":[["de9bdd4.f0ffe2","f8ed9714.c9d948"]]},{"id":"f8ed9714.c9d948","type":"websocket out","z":"db7684b1.4266a8","name":"","server":"cee8b808.bfd788","client":"","x":990,"y":640,"wires":[]},{"id":"bf45dff7.d8f95","type":"mqtt in","z":"db7684b1.4266a8","name":"","topic":"drone/battery","qos":"1","datatype":"auto","broker":"bc647504.9ec4b8","x":70,"y":720,"wires":[["6ee4ca06.42ff74"]]},{"id":"5519ea26.0de884","type":"mqtt in","z":"db7684b1.4266a8","name":"","topic":"drone/position","qos":"2","datatype":"auto","broker":"bc647504.9ec4b8","x":70,"y":660,"wires":[["6ee4ca06.42ff74"]]},{"id":"5f61596b.1ad1a8","type":"mqtt in","z":"db7684b1.4266a8","name":"","topic":"drone/acceleration","qos":"1","datatype":"auto","broker":"bc647504.9ec4b8","x":90,"y":480,"wires":[["6ee4ca06.42ff74"]]},{"id":"62c59cd2.178fc4","type":"mqtt in","z":"db7684b1.4266a8","name":"","topic":"drone/speed","qos":"1","datatype":"auto","broker":"bc647504.9ec4b8","x":70,"y":540,"wires":[["6ee4ca06.42ff74"]]},{"id":"e8c987aa.f1f028","type":"mqtt in","z":"db7684b1.4266a8","name":"","topic":"drone/orientation","qos":"1","datatype":"auto","broker":"bc647504.9ec4b8","x":80,"y":600,"wires":[["6ee4ca06.42ff74"]]},{"id":"13b9c934.577517","type":"inject","z":"db7684b1.4266a8","name":"","topic":"","payload":"50","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":220,"wires":[["85c308fd.e0b4a8"]]},{"id":"85c308fd.e0b4a8","type":"mqtt out","z":"db7684b1.4266a8","name":"","topic":"drone/speed","qos":"","retain":"","broker":"bc647504.9ec4b8","x":450,"y":240,"wires":[]},{"id":"de9bdd4.f0ffe2","type":"debug","z":"db7684b1.4266a8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1040,"y":520,"wires":[]},{"id":"6ee4ca06.42ff74","type":"function","z":"db7684b1.4266a8","name":"store","func":"\nflow.set(msg.topic, msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":580,"wires":[["f70f8b28.0e8b38","c85cff95.9f24"]]},{"id":"f70f8b28.0e8b38","type":"debug","z":"db7684b1.4266a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":520,"y":420,"wires":[]},{"id":"c42dfabb.c9c0b8","type":"inject","z":"db7684b1.4266a8","name":"","topic":"battery","payload":"98","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":280,"wires":[["e93561b4.44dda"]]},{"id":"e93561b4.44dda","type":"mqtt out","z":"db7684b1.4266a8","name":"","topic":"drone/battery","qos":"","retain":"","broker":"bc647504.9ec4b8","x":450,"y":300,"wires":[]},{"id":"b373b13d.23055","type":"http in","z":"db7684b1.4266a8","name":"","url":"/data","method":"get","upload":false,"swaggerDoc":"","x":90,"y":900,"wires":[["e01d9f74.d6a84","79015c13.12c064"]]},{"id":"e01d9f74.d6a84","type":"function","z":"db7684b1.4266a8","name":"","func":"let sub = global.subscriptions || {};\nfor(let key in msg.req.query){\n    if(msg.req.query[key] == 'true')\n        sub[key] = true;\n    else sub[key] = false;\n    \n}\nglobal.subscriptions = sub;\n\nmsg.payload = \"\";\nfor(let key of Object.keys(sub)){\n    msg.payload += `${key}: ${sub[key]};\\n`;\n}\n//msg.payload = flow.get(\"drone/\" + msg.req.query);\nmsg.subs = global.subscriptions;\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":900,"wires":[["90591b86.dddf68","3f21adad.b41b62"]]},{"id":"90591b86.dddf68","type":"http response","z":"db7684b1.4266a8","name":"","statusCode":"200","headers":{},"x":520,"y":900,"wires":[]},{"id":"79015c13.12c064","type":"debug","z":"db7684b1.4266a8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":410,"y":800,"wires":[]},{"id":"3f21adad.b41b62","type":"debug","z":"db7684b1.4266a8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"subs","targetType":"msg","x":660,"y":800,"wires":[]},{"id":"2dd95d02.627192","type":"inject","z":"db7684b1.4266a8","name":"","topic":"","payload":"45","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":180,"wires":[["8d0b449.cd0b6b8"]]},{"id":"8d0b449.cd0b6b8","type":"mqtt out","z":"db7684b1.4266a8","name":"","topic":"drone/orientation","qos":"","retain":"","broker":"bc647504.9ec4b8","x":380,"y":160,"wires":[]},{"id":"a509b0cd.abb3f","type":"inject","z":"db7684b1.4266a8","name":"","topic":"","payload":"105","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":120,"wires":[["8d0b449.cd0b6b8"]]}]