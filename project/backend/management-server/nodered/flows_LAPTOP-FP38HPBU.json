[{"id":"e1376dd6.d0ef7","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"88d0e0ca.30992","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"1f2e560c.8be93a","type":"tab","label":"Flow 3","disabled":false,"info":""},{"id":"596ff1d0.8ce0d","type":"tab","label":"Flow 5","disabled":false,"info":""},{"id":"d38031d9.8ef45","type":"websocket-listener","z":"","path":"/ws/data","wholemsg":"false"},{"id":"a3be8704.2eedb8","type":"mqtt-broker","z":"","name":"mosquitto","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"7c9721e9.635b3","type":"http in","z":"e1376dd6.d0ef7","name":"","url":"/data","method":"put","upload":false,"swaggerDoc":"","x":150,"y":60,"wires":[["500d1c44.582164"]]},{"id":"500d1c44.582164","type":"function","z":"e1376dd6.d0ef7","name":"specifySubs","func":"let sub = global.get(\"subscriptions\") || {};\nfor(let key in msg.payload){\n    console.log(key);\n    if(msg.payload[key] == true)\n        sub[key] = true;\n    else sub[key] = false;\n    \n}\nglobal.set(\"subscriptions\", sub);\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":60,"wires":[["d3b7fb4.a088008"]]},{"id":"697e1a8c.5ee4d4","type":"http response","z":"e1376dd6.d0ef7","name":"","statusCode":"200","headers":{},"x":820,"y":100,"wires":[]},{"id":"ceefe5ef.6b0f18","type":"function","z":"e1376dd6.d0ef7","name":"setAllSubs","func":"let sub = global.get(\"subscriptions\") || {};\nsub.acceleration = true;\nsub.speed = true;\nsub.orientation = true;\nsub.position = true;\nsub.battery = true;\nglobal.set(\"subscriptions\", sub);\n\nreturn msg;\n","outputs":1,"noerr":0,"x":370,"y":140,"wires":[["d3b7fb4.a088008"]]},{"id":"3bb87939.17f2c6","type":"http in","z":"e1376dd6.d0ef7","name":"","url":"/data/all","method":"put","upload":false,"swaggerDoc":"","x":160,"y":140,"wires":[["ceefe5ef.6b0f18"]]},{"id":"a55fec.e4cdd018","type":"http in","z":"e1376dd6.d0ef7","name":"","url":"/data/none","method":"put","upload":false,"swaggerDoc":"","x":170,"y":180,"wires":[["d448abde.d6d858"]]},{"id":"d448abde.d6d858","type":"function","z":"e1376dd6.d0ef7","name":"clearSubs","func":"global.set(\"subscriptions\", {});\n\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":180,"wires":[["d3b7fb4.a088008"]]},{"id":"d3b7fb4.a088008","type":"function","z":"e1376dd6.d0ef7","name":"generatePayload","func":"let sub = global.get(\"subscriptions\") || {};\n\nfor(let key of Object.keys(sub)){\n    msg.payload[key] = sub[key];\n}\n//msg.payload = global.get(\"drone/\" + msg.req.query);\nmsg.subs = global.subscriptions;\n\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":100,"wires":[["697e1a8c.5ee4d4","4925c4b9.709e9c"]]},{"id":"18425383.4b944c","type":"debug","z":"e1376dd6.d0ef7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1030,"y":60,"wires":[]},{"id":"4925c4b9.709e9c","type":"change","z":"e1376dd6.d0ef7","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"subscriptions","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":60,"wires":[["18425383.4b944c"]]},{"id":"dde68ba.65cfd78","type":"http in","z":"e1376dd6.d0ef7","name":"","url":"/data","method":"get","upload":false,"swaggerDoc":"","x":150,"y":100,"wires":[["d3b7fb4.a088008"]]},{"id":"df3ca299.c66b4","type":"http response","z":"88d0e0ca.30992","name":"","statusCode":"200","headers":{},"x":580,"y":180,"wires":[]},{"id":"352c17dd.f16708","type":"http in","z":"88d0e0ca.30992","name":"","url":"/path/set","method":"post","upload":false,"swaggerDoc":"","x":170,"y":180,"wires":[["cd09df88.05cb"]]},{"id":"b02dc8b4.c9e418","type":"http in","z":"88d0e0ca.30992","name":"","url":"drone/start","method":"post","upload":false,"swaggerDoc":"","x":180,"y":280,"wires":[["cf1d8d36.25545"]]},{"id":"ed0054d0.1691c8","type":"http in","z":"88d0e0ca.30992","name":"","url":"drone/pause","method":"post","upload":false,"swaggerDoc":"","x":180,"y":440,"wires":[["b8e7cbcb.dc0a38"]]},{"id":"b8e7cbcb.dc0a38","type":"function","z":"88d0e0ca.30992","name":"set statusinfo","func":"global.set('flying', false);\n\nglobal.set('statusinfo', {\"validated\": true, \"sent\": true, \"flying\": false});\n\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":440,"wires":[["88625639.445958","8682e49c.29ac48"]]},{"id":"cf1d8d36.25545","type":"switch","z":"88d0e0ca.30992","name":"destination is null?","property":"destination","propertyType":"global","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","repair":false,"outputs":2,"x":410,"y":280,"wires":[["4338c0b6.f049"],["d73c8141.b6bc6"]]},{"id":"d73c8141.b6bc6","type":"http response","z":"88d0e0ca.30992","name":"","statusCode":"500","headers":{},"x":600,"y":300,"wires":[]},{"id":"4338c0b6.f049","type":"function","z":"88d0e0ca.30992","name":"send dest + statusinfo","func":"global.set('statusinfo', {\"validated\": true, \"sent\": true, \"flying\": true});\nglobal.set('flying', true);\n\nmsg.payload = global.get('destination');\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":260,"wires":[["64e3e25f.6d157c","20f6b49b.52d78c"]]},{"id":"88625639.445958","type":"http response","z":"88d0e0ca.30992","name":"","statusCode":"200","headers":{},"x":560,"y":420,"wires":[]},{"id":"8682e49c.29ac48","type":"mqtt out","z":"88d0e0ca.30992","name":"","topic":"drone/pause","qos":"1","retain":"","broker":"a3be8704.2eedb8","x":570,"y":460,"wires":[]},{"id":"cd09df88.05cb","type":"function","z":"88d0e0ca.30992","name":"stel beginparams in","func":"var moveteller = 1;\n\n\nglobal.set('waypoints',msg.payload);\nmsg.payload = global.get('waypoints').waypoints[moveteller++];\nglobal.set('mapid', global.get('waypoints').mapId);\nglobal.set(\"destination\", msg.payload);\nglobal.set('moveteller', moveteller);\n//reset want nieuwe coo om naartoe te gaan\nglobal.set('stop',false);\nglobal.set('scanning', false);\nglobal.set('arrived', false);\n\n\nglobal.set('flying', false)\n\nglobal.set('statusinfo', {\"validated\": true, \"sent\": true, \"flying\": false});\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":180,"wires":[["df3ca299.c66b4"]],"info":"Nadat het pad getekend en gevalideerd is, gaan de beginparameters ingesteld \nworden zodat alles klaar is voor de vlucht.\n\n - moveteller [global]: wordt gebruikt om de verschillende waypoints te overlopen -\n    word op 1 gezet omdat het eerste waypoint zijn startlocatie is\n - waypoints [global]: de payload bevat de verschillende waypoints van het getekende pad\n - destination [global]: de destination wordt gezet op het eerst volgende waypoint,\n    daarna wordt de moveteller ge√Øncrementeert en terug geset\n - stop [global]: geeft aan of de drone al zijn waypoints heeft afgelopen of niet\n - scanning [global]: geeft aan of de drone op een waypoint zit dat nodig is om te scannen\n - arrived [global]: geeft aan of de drone op zijn waypoint is toegekomen\n - flying [global]: geeft aan of de drone aan het vliegen is\n - statusinfo [global]: geeft de status van de drone aan, in dit geval is het\n    pad al getekend en doorgestuurd naar de drone maar de drone is nog niet gestart"},{"id":"64e3e25f.6d157c","type":"mqtt out","z":"88d0e0ca.30992","name":"","topic":"drone/start","qos":"1","retain":"","broker":"a3be8704.2eedb8","x":850,"y":280,"wires":[]},{"id":"d7fc0efc.54d38","type":"http in","z":"88d0e0ca.30992","name":"","url":"/statusinfo","method":"get","upload":false,"swaggerDoc":"","x":170,"y":760,"wires":[["7508e98c.b9b038"]]},{"id":"7508e98c.b9b038","type":"function","z":"88d0e0ca.30992","name":"get info","func":"msg.payload = global.get('statusinfo') || {\"validated\": false, \"sent\": false, \"flying\": false};\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":760,"wires":[["7c39d5be.1e8d7c"]]},{"id":"7c39d5be.1e8d7c","type":"http response","z":"88d0e0ca.30992","name":"","statusCode":"200","headers":{},"x":520,"y":760,"wires":[]},{"id":"520a50b7.24c5b","type":"http request","z":"88d0e0ca.30992","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"http://localhost:3000/api/flightpath","tls":"","proxy":"","authType":"basic","x":390,"y":80,"wires":[["83b5b020.4c09b"]]},{"id":"279f9214.30608e","type":"http in","z":"88d0e0ca.30992","name":"","url":"/path/validate","method":"post","upload":false,"swaggerDoc":"","x":180,"y":80,"wires":[["520a50b7.24c5b"]]},{"id":"abcdbbbd.04b9f8","type":"function","z":"88d0e0ca.30992","name":"set statusinfo validated true","func":"global.set('statusinfo', {\"validated\": true, \"sent\": false, \"flying\": false});\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":60,"wires":[["45d735ef.0f362c"]]},{"id":"83b5b020.4c09b","type":"switch","z":"88d0e0ca.30992","name":"Validating succeeded?","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"neq","v":"200","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":600,"y":80,"wires":[["abcdbbbd.04b9f8"],["31485a33.2f42b6"]]},{"id":"31485a33.2f42b6","type":"function","z":"88d0e0ca.30992","name":"set statusinfo validated false","func":"global.set('statusinfo', {\"validated\": false, \"sent\": false, \"flying\": false});\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":100,"wires":[["281850b9.e5f22"]]},{"id":"45d735ef.0f362c","type":"http response","z":"88d0e0ca.30992","name":"","statusCode":"200","headers":{},"x":1080,"y":60,"wires":[]},{"id":"281850b9.e5f22","type":"http response","z":"88d0e0ca.30992","name":"","statusCode":"500","headers":{},"x":1080,"y":100,"wires":[]},{"id":"20f6b49b.52d78c","type":"http response","z":"88d0e0ca.30992","name":"","statusCode":"200","headers":{},"x":840,"y":240,"wires":[]},{"id":"e4e8c3d8.275e4","type":"http in","z":"88d0e0ca.30992","name":"","url":"drone/stop","method":"post","upload":false,"swaggerDoc":"","x":180,"y":560,"wires":[["980494b8.9cfef8"]]},{"id":"980494b8.9cfef8","type":"function","z":"88d0e0ca.30992","name":"set statusinfo","func":"global.set('flying', false);\n\nglobal.set('statusinfo', {\"validated\": false, \"sent\": false, \"flying\": false});\n\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":560,"wires":[["85cf921f.12469","9ccb7a2e.93ee18"]]},{"id":"85cf921f.12469","type":"http response","z":"88d0e0ca.30992","name":"","statusCode":"200","headers":{},"x":560,"y":540,"wires":[]},{"id":"9ccb7a2e.93ee18","type":"mqtt out","z":"88d0e0ca.30992","name":"","topic":"drone/stop","qos":"1","retain":"","broker":"a3be8704.2eedb8","x":570,"y":580,"wires":[]},{"id":"a2dfb978.13dc08","type":"mqtt in","z":"88d0e0ca.30992","name":"","topic":"drone/start","qos":"1","datatype":"auto","broker":"a3be8704.2eedb8","x":140,"y":360,"wires":[["6b2334ab.04ae6c"]]},{"id":"6b2334ab.04ae6c","type":"mqtt out","z":"88d0e0ca.30992","name":"","topic":"drone/moveto","qos":"1","retain":"","broker":"a3be8704.2eedb8","x":330,"y":360,"wires":[]},{"id":"aaf8b4c6.5dc338","type":"http in","z":"88d0e0ca.30992","name":"","url":"drone/homebase","method":"post","upload":false,"swaggerDoc":"","x":200,"y":680,"wires":[["2a2369d8.c6ef86","30d8b960.d56f66"]]},{"id":"2a2369d8.c6ef86","type":"mqtt out","z":"88d0e0ca.30992","name":"","topic":"drone/homebase","qos":"","retain":"","broker":"a3be8704.2eedb8","x":450,"y":660,"wires":[]},{"id":"30d8b960.d56f66","type":"http response","z":"88d0e0ca.30992","name":"","statusCode":"200","headers":{},"x":420,"y":700,"wires":[]},{"id":"b18666ae.bf8a48","type":"mqtt in","z":"1f2e560c.8be93a","name":"","topic":"drone/battery","qos":"1","datatype":"json","broker":"a3be8704.2eedb8","x":190,"y":80,"wires":[["5414530.8ab45ac"]]},{"id":"2114ce87.043ce2","type":"mqtt in","z":"1f2e560c.8be93a","name":"","topic":"drone/position","qos":"2","datatype":"json","broker":"a3be8704.2eedb8","x":190,"y":140,"wires":[["5414530.8ab45ac"]]},{"id":"2107c364.093e4c","type":"mqtt in","z":"1f2e560c.8be93a","name":"","topic":"drone/acceleration","qos":"1","datatype":"json","broker":"a3be8704.2eedb8","x":210,"y":200,"wires":[["5414530.8ab45ac"]]},{"id":"b750c76e.d04448","type":"mqtt in","z":"1f2e560c.8be93a","name":"","topic":"drone/speed","qos":"1","datatype":"json","broker":"a3be8704.2eedb8","x":190,"y":260,"wires":[["5414530.8ab45ac"]]},{"id":"de9ebc91.b5487","type":"mqtt in","z":"1f2e560c.8be93a","name":"","topic":"drone/orientation","qos":"1","datatype":"json","broker":"a3be8704.2eedb8","x":200,"y":320,"wires":[["5414530.8ab45ac"]]},{"id":"4d952a49.693594","type":"function","z":"1f2e560c.8be93a","name":"convertPayload","func":"let subs = global.get('subscriptions') || {};\nmsg.subs = subs;\n\nlet properties = {};\n\nif(Object.keys(subs).length) {\n    for (let key in subs){\n        if(subs[key] === true)\n            properties[key] = global.get('drone/' + key);\n    }\n}\nproperties['radius'] = global.get('drone/radius');\n\nlet position = subs['position'] ? global.get('drone/position') : {\"x\":0, \"y\":0, \"z\":0};\nlet geoJSON = {\n            \"type\": \"FeatureCollection\",\n            \"features\": [{\n                \"type\": \"Feature\",\n                \"properties\": properties,\n                \"geometry\": {\n                    \"type\": \"Point\",\n                    \"coordinates\": [position.x, position.y, position.z]\n                }\n            }]\n        };\n        \nmsg.payload = geoJSON;\nreturn msg;","outputs":1,"noerr":0,"x":1020,"y":180,"wires":[["1b18ff11.0b27b1"]]},{"id":"1b18ff11.0b27b1","type":"websocket out","z":"1f2e560c.8be93a","name":"","server":"d38031d9.8ef45","client":"","x":1250,"y":180,"wires":[]},{"id":"22b9e2e9.457ffe","type":"http in","z":"1f2e560c.8be93a","name":"","url":"/drone","method":"put","upload":false,"swaggerDoc":"","x":200,"y":380,"wires":[["4e273f61.30afb"]]},{"id":"dca1c9ca.24f008","type":"function","z":"1f2e560c.8be93a","name":"drone/radius","func":"msg.topic = 'drone/radius';\n\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":380,"wires":[["80919998.6efb38","7a6ccdff.fe3a44"]]},{"id":"4e273f61.30afb","type":"template","z":"1f2e560c.8be93a","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{payload}}","output":"json","x":380,"y":380,"wires":[["dca1c9ca.24f008"]]},{"id":"5414530.8ab45ac","type":"json","z":"1f2e560c.8be93a","name":"","property":"payload","action":"obj","pretty":false,"x":430,"y":180,"wires":[["7a6ccdff.fe3a44"]]},{"id":"80919998.6efb38","type":"http response","z":"1f2e560c.8be93a","name":"","statusCode":"200","headers":{},"x":720,"y":380,"wires":[]},{"id":"7a6ccdff.fe3a44","type":"function","z":"1f2e560c.8be93a","name":"store","func":"global.set(msg.topic, msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":180,"wires":[["4d952a49.693594"]]},{"id":"e52a4640.117118","type":"mqtt in","z":"596ff1d0.8ce0d","name":"","topic":"drone/scanned","qos":"1","datatype":"auto","broker":"a3be8704.2eedb8","x":160,"y":580,"wires":[["47ab7bca.24e2a4","b6c8df7e.fde7b"]]},{"id":"2a9062d8.de70be","type":"http request","z":"596ff1d0.8ce0d","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"http://localhost:3000/api/maps/{{{mapid}}}/scanzones/{{{scanzoneid}}}/products","tls":"","proxy":"","authType":"basic","x":870,"y":600,"wires":[["4406a313.d6cc1c"]]},{"id":"e71bce51.5bfef","type":"comment","z":"596ff1d0.8ce0d","name":"","info":"Eerst moet hij de juiste scangegevens doorsturen naar de drone\nEenmaal gescant, moeten de juiste gegevens in de databank worden opgeslaan (API endpoint)\n-moet nog gebeuren-","x":280,"y":520,"wires":[]},{"id":"4406a313.d6cc1c","type":"switch","z":"596ff1d0.8ce0d","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1070,"y":580,"wires":[["a6ee5f4a.e01e4"]]},{"id":"47ab7bca.24e2a4","type":"function","z":"596ff1d0.8ce0d","name":"next destination","func":"var moveteller = global.get('moveteller');\nvar waypoints = global.get('waypoints');\nvar stop = global.get('stop');\n\nif(moveteller < waypoints.waypoints.length) {\n    msg.payload = waypoints.waypoints[moveteller++];\n    global.set('destination',msg.payload);\n}\nelse{\n    stop = true;\n}\n/*else {\n    //positie om terug te keren\n    moveteller -= 2;\n    stop = true;\n}*/\n\nglobal.set('moveteller', moveteller);\nglobal.set('stop', stop);\nglobal.set('scanning', false);\n\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":640,"wires":[["af7cdc9c.c3944"]]},{"id":"a6ee5f4a.e01e4","type":"debug","z":"596ff1d0.8ce0d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1230,"y":580,"wires":[]},{"id":"af7cdc9c.c3944","type":"mqtt out","z":"596ff1d0.8ce0d","name":"","topic":"drone/moveto","qos":"","retain":"","broker":"a3be8704.2eedb8","x":610,"y":640,"wires":[]},{"id":"b6c8df7e.fde7b","type":"json","z":"596ff1d0.8ce0d","name":"","property":"payload","action":"obj","pretty":false,"x":350,"y":580,"wires":[["b6977c0d.68af5"]]},{"id":"b6977c0d.68af5","type":"function","z":"596ff1d0.8ce0d","name":"set urldata","func":"msg.post = msg.payload.post\n\nmsg.mapid = global.get('mapid')\nmsg.scanzoneid = msg.payload.scanzoneId\nmsg.productid = msg.payload.product._id\n\nmsg.payload = msg.payload.product\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":580,"wires":[["88db2501.36eea8"]]},{"id":"88db2501.36eea8","type":"switch","z":"596ff1d0.8ce0d","name":"","property":"post","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":690,"y":580,"wires":[["9d612746.bd6168","7b9786dc.df8538"],["2a9062d8.de70be","7b9786dc.df8538"]]},{"id":"9d612746.bd6168","type":"http request","z":"596ff1d0.8ce0d","name":"","method":"PUT","ret":"txt","paytoqs":false,"url":"http://localhost:3000/api/maps/{{{mapid}}}/scanzones/{{{scanzoneid}}}/products/{{productid}}","tls":"","proxy":"","authType":"basic","x":870,"y":560,"wires":[["4406a313.d6cc1c"]]},{"id":"7b9786dc.df8538","type":"debug","z":"596ff1d0.8ce0d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":870,"y":500,"wires":[]},{"id":"92db32e8.c8e4f","type":"function","z":"596ff1d0.8ce0d","name":"radius - arrived?","func":"var stop = global.get('stop') || false;\nvar moveteller = global.get('moveteller');\nvar destination = global.get('destination');\nvar diffX = Math.abs(msg.payload.x - destination.x);\nvar diffY = Math.abs(msg.payload.y - destination.y);\nvar scan = destination.scan;\nvar waypoints = global.get('waypoints');\n\n//enkel in de eerste if moet hij checken om te scannen\nif(stop === false && (diffX <= 20 && diffY <= 20)) {\n    //toegekomen dus eerst checken of hij moet scannen voor hij verder gaat\n    //wnr niet moet gescant worden, zoals anders\n    global.set('arrived', true);\n    if(scan === false) {\n        if(moveteller < waypoints.waypoints.length) {\n            msg.payload = waypoints.waypoints[moveteller++];\n            global.set('destination',msg.payload);\n        }\n        else {\n            stop = true;\n        }\n    }\n    //wnr wel moet gescant worden, wordt de volgende positie ingesteld na de scan\n    else {\n        global.set('scanning',scan);\n        msg.payload = waypoints.waypoints[moveteller-1].scanzone;\n    }\n}\n/*\nif(stop === true && (diffX <= waypoints.radius && diffY <= waypoints.radius)) {\n    if(moveteller >= 0) {\n        msg.payload = waypoints.waypoints[moveteller--];\n        global.set('destination', msg.payload);\n    }\n    else {\n        // hier zal een commando komen om de drone te laten landen, anders gaat hij verder gaan in een loop want stop komt op false\n        stop = false;\n    }\n}\n*/\nglobal.set('moveteller', moveteller);\nglobal.set('stop', stop);\nreturn msg;","outputs":1,"noerr":0,"x":920,"y":80,"wires":[["7b0151b2.0bc58"]]},{"id":"7df16529.fd59cc","type":"mqtt out","z":"596ff1d0.8ce0d","name":"","topic":"drone/moveto","qos":"","retain":"","broker":"a3be8704.2eedb8","x":1280,"y":220,"wires":[]},{"id":"35b8dbb5.f03f14","type":"json","z":"596ff1d0.8ce0d","name":"","property":"payload","action":"obj","pretty":false,"x":750,"y":80,"wires":[["92db32e8.c8e4f"]]},{"id":"26bd32de.c2939e","type":"switch","z":"596ff1d0.8ce0d","name":"scanning?","property":"scanning","propertyType":"global","rules":[{"t":"false"}],"checkall":"true","repair":false,"outputs":1,"x":580,"y":80,"wires":[["35b8dbb5.f03f14"]]},{"id":"f65f2dca.bf3b2","type":"switch","z":"596ff1d0.8ce0d","name":"scanning?","property":"scanning","propertyType":"global","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":510,"y":240,"wires":[["cf0525a8.0cc158"],["7f3da160.406e6"]]},{"id":"7f3da160.406e6","type":"mqtt out","z":"596ff1d0.8ce0d","name":"","topic":"drone/scanner","qos":"1","retain":"","broker":"a3be8704.2eedb8","x":720,"y":260,"wires":[]},{"id":"63d569d6.0b6e68","type":"change","z":"596ff1d0.8ce0d","name":"","rules":[{"t":"set","p":"arrived","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":200,"wires":[["58d4f473.69764c"]]},{"id":"cf0525a8.0cc158","type":"switch","z":"596ff1d0.8ce0d","name":"arrived?","property":"arrived","propertyType":"global","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":700,"y":200,"wires":[["63d569d6.0b6e68"]]},{"id":"9aa3766d.4c3508","type":"switch","z":"596ff1d0.8ce0d","name":"flying?","property":"flying","propertyType":"global","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":430,"y":80,"wires":[["26bd32de.c2939e"]]},{"id":"fb16975d.66c628","type":"debug","z":"596ff1d0.8ce0d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1270,"y":180,"wires":[]},{"id":"58d4f473.69764c","type":"switch","z":"596ff1d0.8ce0d","name":"needs scanning?","property":"payload.scan","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":1070,"y":200,"wires":[["7df16529.fd59cc","fb16975d.66c628"]]},{"id":"7b0151b2.0bc58","type":"switch","z":"596ff1d0.8ce0d","name":"stop?","property":"stop","propertyType":"global","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":310,"y":280,"wires":[["f65f2dca.bf3b2"],["285c97fa.8795d8"]]},{"id":"af8a5519.1037f8","type":"mqtt out","z":"596ff1d0.8ce0d","name":"","topic":"drone/pause","qos":"","retain":"","broker":"a3be8704.2eedb8","x":710,"y":320,"wires":[]},{"id":"285c97fa.8795d8","type":"change","z":"596ff1d0.8ce0d","name":"","rules":[{"t":"set","p":"flying","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":320,"wires":[["af8a5519.1037f8"]]},{"id":"780c0c00.3d09e4","type":"mqtt in","z":"596ff1d0.8ce0d","name":"","topic":"drone/position","qos":"2","datatype":"json","broker":"a3be8704.2eedb8","x":270,"y":80,"wires":[["9aa3766d.4c3508"]]}]